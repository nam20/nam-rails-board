<br>
<% if @post.user.is_deleted %>
  <h3>(탈퇴한 유저)</h3>
<% else %>
  <h3>글쓴이: <%= @post.user.name %></h3>
<% end %>
<h3>제목: <%= @post.title %> </h3>
<h3>내용: <%= @post.content %> </h3>

<%= image_tag url_for(@post.image) if @post.image.attached? %>

<h3>좋아요 <%= @post.likes.size %></h3>

<% if session[:user_id] %>

  <% if @post.likes.detect { |like| like.user_id == session[:user_id] } %>
    <h4><%= link_to '좋아요 취소', "#{post_path(@post)}/like", method: :delete %></h4>
  <% else %>
    <h4><%= link_to '좋아요 누르기', "#{post_path(@post)}/like", method: :post %></h4>
  <% end %>

  <% if session[:user_id] == @post.user_id %>
    <h3>
      <%= link_to "수정하기", edit_post_path(@post) %>
      <%= link_to "삭제하기", post_path(@post), method: :delete %>
    </h3>
  <% end %>
<% end %>

<h3><%= link_to "홈", root_path %></h3>

<% if session[:user_id] %>
  <%= form_with(url: "#{post_path(@post)}/comment", method: :post) do |form| %>
    <div>
      <%= form.label :content %>
      <%= form.text_field :content %>
      <%= form.submit %>
    </div>
  <% end %>
<% end %>

<hr>

<% @post.comments.each do |comment| %>
  <h3>
    <%= "=>" * (comment.depth)  %>
    <% if comment.is_deleted %>
      (삭제된 댓글입니다.)
    <% else %>

      <% if comment.user.is_deleted %>
        (탈퇴한 유저)
      <% else %>
        글쓴이: <%= comment.user.name %>
      <% end %>
      <%= "번호: #{comment.id} 내용: #{comment.content}" %>

      <% if session[:user_id] %>

        <%= form_with(url: "#{post_path(@post)}/comment", method: :post) do |form| %>
          <%= form.hidden_field :comment_id, value: "#{comment.id}" %>
          <div>
            <%= form.label :content %>
            <%= form.text_field :content %>
            <%= form.submit %>
          </div>
        <% end %>

        <% if comment.user_id == session[:user_id] %>
          <%= link_to "삭제하기", "#{post_path(@post)}/comment/#{comment.id}", method: 'delete' %>
        <% end %>
      <% end %>
    <% end %>

  </h3>
  <hr>
<% end %>