<br>
<% if @post.user.is_deleted %>
  <h3>(탈퇴한 유저)</h3>
<% else %>
  <h3>글쓴이: <%= @post.user.name %></h3>
<% end %>
<h3>제목: <%= @post.title %> </h3>
<h3>내용: <%= @post.content %> </h3>

<% if @post.image.attached? %>
  <%= image_tag url_for(@post.image) %>
<% end %>

<h3>좋아요 <%= @post.likes.size %></h3>

<% if session[:user_id] %>

  <% if @post.likes.detect { |like| like.user_id == session[:user_id] } %>
    <h4><%= link_to '좋아요 취소', "/post/#{@post.id}/unlike", method: :post %></h4>
  <% else %>
    <h4><%= link_to '좋아요 누르기', "/post/#{@post.id}/like", method: :post %></h4>
  <% end %>

  <% if session[:user_id] == @post.user_id %>
    <a href="/post/<%= @post.id %>/edit">수정하기</a>
    <%= link_to "삭제하기", "/post/#{@post.id}", method: :delete %>
    <%= link_to "삭제하기(임시)", "/post/#{@post.id}/delete", method: :delete %>

  <% end %>
<% end %>

<h3><a href="/">홈</a></h3>

<% if session[:user_id] %>
  <form action="/comment/<%= @post.id %>" method="post">
    <%= hidden_field_tag :authenticity_token, form_authenticity_token %>
    <input type="text" name="content" placeholder="댓글"><input type="submit">
  </form>
<% end %>

<hr>

<% @comments.each do |comment| %>
  <h3>
    <%= "=>" * (comment.depth)  %>
    <% if comment.is_deleted %>
      (삭제된 댓글입니다.)
    <% else %>

      <% if comment.user.is_deleted %>
        (탈퇴한 유저)
      <% else %>
        글쓴이: <%= comment.user.name %>
      <% end %>
      <%= "번호: #{comment.id} 내용: #{comment.content}" %>

      <% if session[:user_id] %>
        <form action="<%= "/comment/#{@post.id}/re/#{comment.id}" %>" method="post">
          <%= hidden_field_tag :authenticity_token, form_authenticity_token %>
          <input type="text" name="content" placeholder="대댓글"><input type="submit">
        </form>

        <% if comment.user_id == session[:user_id] %>
          <%= link_to "삭제하기", "/comment/#{comment.id}", method: 'delete' %>
        <% end %>
      <% end %>
    <% end %>

  </h3>
  <hr>
<% end %>